<?php defined('BASEPATH') OR exit('No direct script access allowed');class Dashboard extends Admin_controller{    function __construct()    {        parent::__construct();        $this->load->helper('dashboard');    }    public function index()    {        if($this->role_id == 4){            $data = [                'job' => $this->countTableData('jobs', $this->user_id),                'applications' => $this->countApplicationsData($this->user_id),                'event' => $this->countTableData('events', $this->user_id),                'login_user_id' => $this->user_id,            ];            $this->viewAdminContent('recruiter_dashboard', $data);        } else {            $data = [                'job' => $this->countTableData('jobs'),                'employer' => $this->countTableData('users'),                'event' => $this->countTableData('events'),                'candidate' => $this->countTableData('candidates'),                'new_job' => $this->countTableData('jobs', 0, 'today'),                'new_employer' => $this->countTableData('users', 0, 'today'),                'new_event' => $this->countTableData('events', 0, 'today'),                'new_candidate' => $this->countTableData('candidates', 0, 'today'),                'new_payment' => $this->countPaymentData(0, 'today'),                'login_user_id' => $this->user_id,            ];            $this->viewAdminContent('dashboard', $data);        }    }    private function countTableData($table = 'jobs', $user_id = 0, $create = 'all')    {        $status = in_array($table, ['jobs','events']) ? 'Published' : 'Active';        $this->db->where('status', $status);        if ($table == 'users') {            $this->db->where('role_id', 4);        }        if ($user_id) {            $this->db->where('user_id', $user_id);        }        if($create == 'today'){            $this->db->like('created_at', date('Y-m-d'));        }        return $this->db->count_all_results($table);    }    private function countPaymentData($user_id = 0, $create = 'all')    {        $this->db->select('SUM(paid_amount) as Total');        $this->db->where('payment_status', 'succeeded');        if ($user_id) {            $this->db->where('user_id', $user_id);        }        if($create == 'today'){            $this->db->like('created_at', date('Y-m-d'));        }        $row = $this->db->from('transactions')->get()->row();        if($row){            return $row->Total;        } else {            return 0;        }    }    private function countApplicationsData($user_id = 0)    {        if ($user_id) {            $this->db->where('j.user_id', $user_id);        }        $this->db->from('job_applications as a');        $this->db->join('jobs as j', 'j.id = a.job_id');        return $this->db->count_all_results();    }}